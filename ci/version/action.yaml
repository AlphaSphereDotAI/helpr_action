name: Version
description: Automated version bumping and tagging
inputs:
  bump_type:
    description: Type of version bump (patch, minor, major)
    required: false
    default: "patch"
  commit_changes:
    description: Whether to commit version changes
    required: false
    default: "true"
  create_tag:
    description: Whether to create a git tag
    required: false
    default: "true"
outputs:
  new_version:
    description: The new version after bumping
    value: ${{ steps.get_package_version.outputs.result }}
runs:
  using: composite
  steps:
    - name: Increase the version
      run: uv version --bump ${{ inputs.bump_type }}
      shell: bash
    - name: Get Package version
      id: get_package_version
      run: echo "result=$(uv version --short)" >> $GITHUB_OUTPUT
      shell: bash
    - name: Commit updated version
      if: ${{ inputs.commit_changes == 'true' }}
      uses: stefanzweifel/git-auto-commit-action@v7.0.0
      with:
        commit_message: "Tag: ${{ steps.get_package_version.outputs.result }}"
        tagging_message: ${{ steps.get_package_version.outputs.result }}
    - name: Create tag manually
      if: ${{ inputs.create_tag == 'true' && inputs.commit_changes == 'false' }}
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add pyproject.toml
        git commit -m "Tag: ${{ steps.get_package_version.outputs.result }}"
        git tag ${{ steps.get_package_version.outputs.result }}
        git push origin main
        git push origin ${{ steps.get_package_version.outputs.result }}
      shell: bash
